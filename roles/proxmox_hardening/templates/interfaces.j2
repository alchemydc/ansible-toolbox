# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

source /etc/network/interfaces.d/*

auto lo
iface lo inet loopback

iface lo inet6 loopback

auto 
iface {{ public_iface }} inet manual
  address {{ public_ip }}/{{ public_cidr_mask }}
  gateway {{ public_gateway }}

auto {{ public_bridge }}
iface {{ public_bridge }} inet static
	address {{ public_ip }}/{{ public_cidr_mask }}
	gateway {{ public_gateway }}
	bridge-ports {{ public_iface }}
	bridge-stp off
	bridge-fd 0

iface {{ public_iface}} inet6 static
  address {{ public_ipv6 }}/{{ ipv6_cidr_mask }}
  gateway fe80::1

# bridge interface for the VM's and containers
auto {{ private_bridge }}
	iface {{ private_bridge }} inet static
	address {{ private_ip }}/{{ private_cidr_mask }}
	bridge-ports none
	bridge-stp off
	bridge-fd 0

# restore any rules that we want to persist across reboots
pre-up iptables-restore < /etc/iptables.conf
#pre-up ip6tables-restore < /etc/ip6tables.conf
# NAT and masquerading moved to /etc/iptables.conf 
# masquerade any traffic from the VM/CT network so that they have outbound internet access by default
#post-up iptables -t nat -A POSTROUTING -s '{{ private_network }}/{{ private_cidr_mask }}' -o {{ public_iface }} -j MASQUERADE && iptables -t raw -I PREROUTING -i fwbr+ -j CT --zone 1
# persist any rules added on the fly to the fs
pre-down iptables-save > /etc/iptables.conf
#pre-down ip6tables-save > /etc/ip6tables.conf
