#!/bin/bash
set -ex

echo "Starting geth to init keystore..." | logger
# We need to override the entrypoint in the geth image (which is originally `geth`).
# `geth account import` fails when the account has already been imported. In
# this case, we do not want to pipefail

docker run \
  --rm \
  -v {{ celo_data_dir }}:/root/.celo \
  --entrypoint /bin/sh \
  -i {{ geth_docker_repo }}:{{ geth_docker_tag }} \
  -c "geth account import --password {{ attestation_signer_password }} /root/.celo/attestation_signer_key | true"

#echo "Copying encrypted key file to child keystore dir [workaround]" | logger
#cd /root/.celo/keystore
#mkdir -vp keystore
#cp -v UTC--* keystore/