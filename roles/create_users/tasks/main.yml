- name: Create user 
  user:
    name: "{{ user_to_create }}"
    password: '*'   # pw is locked/disabled.  key auth only + passwordless sudo
    state: present
    shell: /usr/bin/bash
    createhome: yes
    home: /home/{{ user_to_create }}
    groups:
      - sudo
  tags:
    - users

- name: Set authorized key for created user
  authorized_key: 
    user: "{{ user_to_create }}"
    state: present
    key: "{{ authorized_key }}"
    manage_dir: yes
  tags:
    - users

- name: Setup common aliases for created user
  lineinfile:
    path: /home/{{ user_to_create }}/.profile
    line: alias ll='ls -laF'
    state: present
  tags:
    - users

- name: Setup common aliases for root user
  lineinfile:
    path: /root/.profile
    line: alias ll='ls -laF'
    state: present
  tags:
    - users

- name: Configure vim
  import_tasks: vim.yml
  tags:
    - users

- name: Install screen and htop
  apt:
    name:
      - screen
      - htop
      - vim
    state: present
    update_cache: true
  tags:
    - users

- name: Setup screenrc for all users
  copy:
    src: 'screenrc'
    dest: '/etc/screenrc'
    owner: 'root'
    group: 'root'
    mode: '0644'
  tags:
    - users

- name: Setup passwordless sudo for members of sudo group
  lineinfile: 
    path: /etc/sudoers
    regexp: '%sudo	ALL=(ALL:ALL) ALL'
    line: '%sudo	ALL=(ALL:ALL) NOPASSWD:ALL' 
  tags:
    - users