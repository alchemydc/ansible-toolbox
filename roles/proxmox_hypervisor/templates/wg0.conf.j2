# Wireguard Interface Configuration
# Auto-generated by Ansible from data-driven configuration
# Host: {{ inventory_hostname }}
# Address: {{ wireguard_peers[inventory_hostname].address }}/24

[Interface]
# Name: {{ inventory_hostname }}
Address = {{ wireguard_peers[inventory_hostname].address }}/24
PrivateKey = {{ wireguard_peers[inventory_hostname].private_key }}
ListenPort = {{ wireguard_peers[inventory_hostname].listen_port | default(wireguard_port) }}

{% for peer_name, peer_config in wireguard_peers.items() %}
{% if peer_name != inventory_hostname %}
[Peer]
# Name: {{ peer_name }}
PublicKey = {{ peer_config.public_key }}
{% if peer_config.endpoint is defined %}
Endpoint = {{ peer_config.endpoint }}
{% elif peer_name.startswith('zd') and vars.get(peer_name + '_public_ip') %}
Endpoint = {{ vars[peer_name + '_public_ip'] }}:{{ wireguard_port }}
{% endif %}
AllowedIPs = {{ peer_config.address }}/32
{% if peer_config.persistent_keepalive is defined %}
PersistentKeepalive = {{ peer_config.persistent_keepalive }}
{% endif %}

{% endif %}
{% endfor %}
